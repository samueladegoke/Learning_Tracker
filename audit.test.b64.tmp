aW1wb3J0IHsgY29udmV4VGVzdCB9IGZyb20gImNvbnZleC10ZXN0IjsKaW1wb3J0IHsgZXhwZWN0LCB0ZXN0IH0gZnJvbSAidml0ZXN0IjsKaW1wb3J0IHNjaGVtYSBmcm9tICIuL3NjaGVtYSI7CmltcG9ydCB7IGFwaSB9IGZyb20gIi4vX2dlbmVyYXRlZC9hcGkiOwoKdGVzdCgiYmVzdF9zdHJlYWsgaXMgdXBkYXRlZCB3aGVuIG5ldyBzdHJlYWsgaXMgaGlnaGVyIiwgYXN5bmMgKCkgPT4gewogIGNvbnN0IHQgPSBjb252ZXhUZXN0KHNjaGVtYSk7CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICBjb25zdCB5ZXN0ZXJkYXkgPSBub3cgLSAyNCAqIDYwICogNjAgKiAxMDAwOwoKICBjb25zdCB1c2VyID0gYXdhaXQgdC5ydW4oYXN5bmMgKGN0eCkgPT4gewogICAgcmV0dXJuIGF3YWl0IGN0eC5kYi5pbnNlcnQoInVzZXJzIiwgewogICAgICB1c2VybmFtZTogInN0cmVha3VzZXIiLAogICAgICBjbGVya191c2VyX2lkOiAic3RyZWFrX2lkIiwKICAgICAgeHA6IDAsCiAgICAgIGxldmVsOiAxLAogICAgICBnb2xkOiAwLAogICAgICBzdHJlYWs6IDUsCiAgICAgIGJlc3Rfc3RyZWFrOiA1LAogICAgICBoZWFydHM6IDUsCiAgICAgIGZvY3VzX3BvaW50czogMTAwLAogICAgICBzdHJlYWtfZnJlZXplX2NvdW50OiAwLAogICAgICBsYXN0X2FjdGl2aXR5X2RhdGU6IHllc3RlcmRheQogICAgfSk7CiAgfSk7CgogIGNvbnN0IGNvdXJzZSA9IGF3YWl0IHQucnVuKGFzeW5jIChjdHgpID0+IGN0eC5kYi5pbnNlcnQoImNvdXJzZXMiLCB7IHRpdGxlOiAiQyIsIGRlc2NyaXB0aW9uOiAiRCIsIHNlcXVlbmNlX29yZGVyOiAxLCBpc19hY3RpdmU6IHRydWUgfSkpOwogIGNvbnN0IHdlZWsgPSBhd2FpdCB0LnJ1bihhc3luYyAoY3R4KSA9PiBjdHguZGIuaW5zZXJ0KCJ3ZWVrcyIsIHsgY291cnNlX2lkOiBjb3Vyc2UsIHRpdGxlOiAiVyIsIGRlc2NyaXB0aW9uOiAiRCIsIHdlZWtfbnVtYmVyOiAxLCBpc19sb2NrZWQ6IGZhbHNlIH0pKTsKICBjb25zdCB0YXNrID0gYXdhaXQgdC5ydW4oYXN5bmMgKGN0eCkgPT4gY3R4LmRiLmluc2VydCgidGFza3MiLCB7IAogICAgd2Vla19pZDogd2VlaywgCiAgICB0aXRsZTogIlQiLCAKICAgIGRlc2NyaXB0aW9uOiAiRCIsIAogICAgdGFza190eXBlOiAidmlkZW8iLCAKICAgIGRpZmZpY3VsdHk6ICJtZWRpdW0iLCAKICAgIHhwX3Jld2FyZDogMTAsIAogICAgZXN0aW1hdGVkX21pbnV0ZXM6IDEwLCAKICAgIHJlcXVpcmVkX2Zvcl9zdHJlYWs6IHRydWUgCiAgfSkpOwoKICAvLyBDb21wbGV0ZSB0YXNrCiAgYXdhaXQgdC53aXRoSWRlbnRpdHkoeyBzdWJqZWN0OiAic3RyZWFrX2lkIiwgaXNzdWVyOiAiY2xlcmsiIH0pLm11dGF0aW9uKGFwaS50YXNrcy5jb21wbGV0ZVRhc2ssIHsgCiAgICB0YXNrSWQ6IHRhc2sgCiAgfSk7CgogIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgdC5ydW4oYXN5bmMgKGN0eCkgPT4gYXdhaXQgY3R4LmRiLmdldCh1c2VyKSk7CiAgaWYgKCF1cGRhdGVkVXNlcikgdGhyb3cgbmV3IEVy
cm9yKCJVc2VyIG5vdCBmb3VuZCIpOwogIGV4cGVjdCh1cGRhdGVkVXNlci5zdHJlYWspLnRvQmUoNik7CiAgZXhwZWN0KHVwZGF0ZWRVc2VyLmJlc3Rfc3RyZWFrKS50b0JlKDYpOwp9KTsKCnRlc3QoImdldFRhc2tCeUxlZ2FjeUlkIHJldHJpZXZlcyB0YXNrIiwgYXN5bmMgKCkgPT4gewogIGNvbnN0IHQgPSBjb252ZXhUZXN0KHNjaGVtYSk7CiAgCiAgY29uc3QgY291cnNlID0gYXdhaXQgdC5ydW4oYXN5bmMgKGN0eCkgPT4gY3R4LmRiLmluc2VydCgiY291cnNlcyIsIHsgdGl0bGU6ICJDIiwgZGVzY3JpcHRpb246ICJEIiwgc2VxdWVuY2Vfb3JkZXI6IDEsIGlzX2FjdGl2ZTogdHJ1ZSB9KSk7CiAgY29uc3Qgd2VlayA9IGF3YWl0IHQucnVuKGFzeW5jIChjdHgpID0+IGN0eC5kYi5pbnNlcnQoIndlZWtzIiwgeyBjb3Vyc2VfaWQ6IGNvdXJzZSwgdGl0bGU6ICJXIiwgZGVzY3JpcHRpb246ICJEIiwgd2Vla19udW1iZXI6IDEsIGlzX2xvY2tlZDogZmFsc2UgfSkpOwogIAogIGNvbnN0IHRhc2sgPSBhd2FpdCB0LnJ1bihhc3luYyAoY3R4KSA9PiB7CiAgICByZXR1cm4gYXdhaXQgY3R4LmRiLmluc2VydCgidGFza3MiLCB7IAogICAgICAgIHdlZWtfaWQ6IHdlZWssIAogICAgICAgIHRpdGxlOiAiVCIsIAogICAgICAgIGRlc2NyaXB0aW9uOiAiRCIsIAogICAgICAgIHRhc2tfdHlwZTogInZpZGVvIiwgCiAgICAgICAgZGlmZmljdWx0eTogImVhc3kiLCAKICAgICAgICB4cF9yZXdhcmQ6IDEwLCAKICAgICAgICBlc3RpbWF0ZWRfbWludXRlczogMTAsIAogICAgICAgIHJlcXVpcmVkX2Zvcl9zdHJlYWs6IHRydWUsCiAgICAgICAgbGVnYWN5X3Rhc2tfaWQ6ICJsZWdhY3lfMTIzIgogICAgfSk7CiAgfSk7CgogIGNvbnN0IHJldHJpZXZlZCA9IGF3YWl0IHQucXVlcnkoYXBpLmN1cnJpY3VsdW0uZ2V0VGFza0J5TGVnYWN5SWQsIHsgbGVnYWN5VGFza0lkOiAibGVnYWN5XzEyMyIgfSk7CiAgZXhwZWN0KHJldHJpZXZlZCkubm90LnRvQmVOdWxsKCk7CiAgZXhwZWN0KHJldHJpZXZlZD8uX2lkKS50b0JlKHRhc2spOwp9KTsK
